include(ExternalProject)

if (NOT USE_SIMD)
    set(EIGEN_ALIGN_FLAGS
        "-DCMAKE_CXX_FLAGS:STRING=-DEIGEN_MAX_ALIGN_BYTES=0 -DEIGEN_MAX_STATIC_ALIGN_BYTES=0"
        "-DCMAKE_C_FLAGS:STRING=-DEIGEN_MAX_ALIGN_BYTES=0 -DEIGEN_MAX_STATIC_ALIGN_BYTES=0")
else()
    set(EIGEN_ALIGN_FLAGS ${CLOUDVIEWERCONFIG_SSE_DEFINITIONS})
    if (MSVC)
        set(EIGEN_ALIGN_FLAGS ${EIGEN_ALIGN_FLAGS} -DEIGEN_TEST_SSE2=ON)
    endif()
endif()
	
ExternalProject_Add(
ext_eigen3
PREFIX eigen3
URL http://gitlab.com/libeigen/eigen/-/archive/3.3.7/eigen-3.3.7.zip
URL_HASH MD5=888aab45512cc0c734b3e8f60280daba
DOWNLOAD_DIR "${CLOUDVIEWER_THIRD_PARTY_DOWNLOAD_DIR}/eigen3"
INSTALL_DIR ${CLOUDVIEWER_EXTERNAL_INSTALL_DIR}
BUILD_IN_SOURCE 0
BUILD_ALWAYS 0
UPDATE_COMMAND ""
CMAKE_ARGS
      ${EIGEN_ALIGN_FLAGS}
      -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
      -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
      -DCMAKE_INSTALL_PREFIX:PATH=<INSTALL_DIR>
)

ExternalProject_Get_Property(ext_eigen3 INSTALL_DIR)
set(EIGEN_INCLUDE_DIRS ${INSTALL_DIR}/include/) # "/" is critical.
set(EIGEN_CMAKE_FLAGS ${EIGEN_ALIGN_FLAGS} -DEigen3_DIR:PATH=${INSTALL_DIR}/share/eigen3/cmake -DEIGEN3_INCLUDE_DIR=${EIGEN_INCLUDE_DIRS} -DEIGEN_INCLUDE_DIR=${EIGEN_INCLUDE_DIRS})

